<!DOCTYPE html>
<html>
  <head>
    <title>Curveball</title>
    <script type="application/javascript" src="jquery-2.1.4.min.js"></script>
		<script type="application/javascript" src="three.min.js"></script>
		<script type="application/javascript" src="init.js"></script>
		<script type="application/javascript" src="ball.js"></script>
		<script type="application/javascript" src="paddle.js"></script>
  </head>
  <body>
    <div id="canvas" style="width: 1000px; height: 600px;"></div>
    <script>
      $('#canvas').on('mouseenter', function () {
        $('#canvas').css('cursor', 'none');
      });
    </script>

    <script>
      var canvasWidth, canvasHeight;
      var scene, camera, renderer;
      var backWallMesh, leftWallMesh, rightWallMesh, floorMesh, ceilingMesh;
      var radius, ball, ballMesh;
      var paddleWidth, paddleHeight, paddle, paddleMesh;

      init();
      var ball = new Ball(ballMesh);
      var paddle = new Paddle(paddleMesh);
      renderer.render(scene, camera);

      function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);

        detectCollisions();

        paddleMesh.position.x = paddle.posX;
        paddleMesh.position.y = paddle.posY;

        ballMesh.position.x += ball.speedX;
        ballMesh.position.y += ball.speedY;
        ballMesh.position.z += ball.speedZ;
      }

      function detectCollisions() {
        if (ballMesh.position.x <= leftWallMesh.position.x + radius) {
          ball.speedX *= -1;
        } else if (ballMesh.position.x >= rightWallMesh.position.x - radius) {
          ball.speedX *= -1;
        }

        if (ballMesh.position.y <= floorMesh.position.y + radius) {
          ball.speedY *= -1;
        } else if (ballMesh.position.y >= ceilingMesh.position.y - radius) {
          ball.speedY *= -1;
        }

        if (ballMesh.position.z <= backWallMesh.position.z + radius) {
          ball.speedZ *= -1;
        } else if (ballMesh.position.z > -radius && paddleCollision()) {
          ball.speedZ *= -1;
        }
      }
      // animate();

      function paddleCollision () {
        var points = ball.getCollisionPoints();
        for (var i = 0; i < points.length; i++) {
          var raycaster = new THREE.Raycaster(points[i], new THREE.Vector3(0, 0, 1));
          var intersects = raycaster.intersectObjects(scene.children);
          if (intersects.length > 0) {
            return true;
          }
        }
        return false;
      }
    </script>
  </body>
</html>
